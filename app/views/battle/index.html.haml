- content_for :body_class, "battle"

.container
  .row
    .col-sm-4
      .well.ethereal
        #player-stats{ :data => {:hp => "#{@user.user_stat.hp}",:speed => "#{@user.user_stat.speed}"} }
          .row
            .col-xs-12
              .pull-left
                %h4
                  = @user.username.capitalize
              .pull-right
                %h4
                  Lv.
                  %span#player-level
                    = @user.user_stat.level
          .row
            .col-xs-6.pull-left
              HP:
              %span#player-hp
                = @user.user_stat.hp
            .col-xs-6.pull-right
              MP:
              %span#player-mp
                = @user.user_stat.mp
          .row
            .col-xs-12
              Armor
              %span#player-armor-rating
                = @user.user_stat.base_defense
        #player-atb-guage
          = render :partial => 'atb_gauge', :locals => { :atb_owner => 'player' }
    
    .col-sm-4.col-sm-offset-4
      .well.ethereal
        #enemy-stats{ :data => {:enemyid => "#{@enemy.id}", :hp => "#{@enemy.hp}", :mp => "#{@enemy.mp}", :baseatk => "#{@enemy.base_attack}", :baseaef => "#{@enemy.base_defense}", :speed => "#{@enemy.speed}"} }
          .row
            .col-xs-12
              .pull-left
                %h4
                  = @enemy.name.capitalize
              .pull-right
                %h4
                  Lv.
                  %span#enemy-level
                    = @enemy.level
          .row
            .col-xs-6.pull-left
              HP
              %span#enemy-hp
                = @enemy.hp
          .row
            .col-xs-12
              Armor
              %span#enemy-armor-rating
                = @enemy.base_defense
        #enemy-atb-guage
          = render :partial => 'atb_gauge', :locals => { :atb_owner => 'enemy' }

  .row
    .col-sm-12.text-center
      #player-actions
        %table.table.table-bordered
          %tr
            %td
              .btn-group
                %button.btn.btn-default.action#attack{ :data => {"action-type" => "attack"} }
                  Attack
            %td
              .btn-group
                %button.btn.btn-default.dropdown-toggle#skill{ :type => "button", :data => {"toggle" => "dropdown"} }
                  Skills
                  %span.caret
                %ul.dropdown-menu#skills-menu{ :role => "menu" }
                  - @user.skills.each do |skill|
                    %li.action{ :data => {"action-type" => "skills", "action-taken" => "#{skill.name.downcase}"} }
                      = link_to "#" do
                        = skill.name
                        %span.ss-icon.ss-info.pull-right{ :id => "#{skill.name}", :title => "#{skill.description}", :data => {"toggle" => "tooltip", "placement" => "auto"} }
          %tr
            %td
              .btn-group
                %button.btn.btn-default.dropdown-toggle#magic{ :type => "button", :data => {"toggle" => "dropdown"} }
                  Magic
                  %span.caret
                %ul.dropdown-menu#magic-menu{ :role => "menu" }
                  %li.action
                    = link_to "Magic 1", "#"
            %td
              .btn-group
                %button.btn.btn-default.dropdown-toggle#item{ :type => "button", :data => {"toggle" => "dropdown"} }
                  Items
                  %span.caret
                %ul.dropdown-menu#items-menu{ :role => "menu" }
                  %li.action
                    = link_to "Item 1", "#"


      %button.btn.btn-defualt.btn-block#dev-button{ :data => {:toggle => "modal", :target => "#level-up-modal"} }
        \.dev Button

.modal.fade#winner-modal{ :tabindex => "-1", :role => "dialog", "aria-hidden" => true, "aria-labelledby" => "winner-modal-label"}
  .modal-dialog
    .modal-content
      .modal-header
        %button.close{ :data => {:dismiss => "modal"} }
          %span{ "aria-hidden" => true }
            &times;
          %span.sr-only
            Close
        %h3.modal-title.text-center#winner-modal-label
          Victory is yours!
      .modal-body
        .row
          .col-xs-3
            %h4.no-margin 
              Lv.
              %span#modal-player-level
                = @user.user_stat.level
          .col-xs-9
            .progress.no-margin
              .progress-bar.progress-bar-warning.player-exp-bar.remove-progress-bar-transition{:role => "progressbar", :valuemin => "0", :valuemax => "100", :style => "width: #{@percent_to_level}%;"}
        .row
          .col-xs-12
            .text-center
              .experience 
                Experience: 
                %span{ :class => 'current-experience' } 
                  = @user.user_stat.current_experience
                \/
                %span{ :class => 'next-level-exp' }
                  = @next_level_experience
        .row
          .col-xs-12
            %h4
              Rewards
            %ul
              %li#exp-reward
              %li#ap-reward


      .modal-footer
        %button.btn.btn-primary{ :data => {:dismiss => "modal"} }
          Continue

//Prevents navigation away from page if battle is active
:javascript
  $(window).on('beforeunload', function() {
    if (!winConditionCheck()) {
      return 'Leaving the battle will forfeit your rewards.'
    }
  });



